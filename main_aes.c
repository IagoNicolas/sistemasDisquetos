/**
 * @file main.c
 * @brief RSA keypair generation, encryption, decryption, and signing.
 *
 * This program demonstrates how to generate an RSA keypair, save the keys and key components,
 * encrypt and decrypt data, and sign and verify messages using the OpenSSL library.
 */

#include <time.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <openssl/rsa.h>
#include <openssl/pem.h>
#include <openssl/err.h>
#include <openssl/aes.h>
#include <openssl/rand.h>
#include <openssl/evp.h>

/**
 * @def RSA_KEY_BITS
 * @brief Number of bits in the RSA key. Max supported value is 8192.
 */
#define RSA_KEY_BITS 1024
#define AES_KEY_SIZE 256
#define AES_BLOCK_SIZE 16

/**
 * @brief Handles OpenSSL errors by printing them and aborting the program.
 */
void handleErrors(void) {
    ERR_print_errors_fp(stderr);
    abort();
}

/**
 * @brief Generates an RSA keypair.
 *
 * @param[out] rsa_keypair Pointer to an RSA structure that will hold the generated keypair.
 */
void generate_keypair(RSA **rsa_keypair) {
    BIGNUM *e = BN_new();
    RSA *rsa = RSA_new();

    if (!e || !rsa) { handleErrors(); }

    // Set public exponent
    BN_set_word(e, RSA_F4);

    // Generate RSA keypair
    if (!RSA_generate_key_ex(rsa, RSA_KEY_BITS, e, NULL)) { handleErrors(); }

    *rsa_keypair = rsa;

    BN_free(e);
}

/**
 * @brief Saves the RSA keypair to files.
 *
 * @param[in] rsa_keypair Pointer to the RSA keypair to save.
 */
void save_keys(RSA *rsa_keypair) {
    // Save the public key
    FILE *pub_file = fopen("public_key.txt", "wb");
    if (!pub_file) { handleErrors(); }
    PEM_write_RSA_PUBKEY(pub_file, rsa_keypair);
    fclose(pub_file);

    // Save the private key
    FILE *priv_file = fopen("private_key.txt", "wb");
    if (!priv_file) { handleErrors(); }
    PEM_write_RSAPrivateKey(priv_file, rsa_keypair, NULL, NULL, 0, NULL, NULL);
    fclose(priv_file);
}

/**
 * @brief Writes a BIGNUM value to a file with a label.
 *
 * @param[in] file File pointer to write to.
 * @param[in] label Label for the BIGNUM value.
 * @param[in] bn BIGNUM value to write.
 */
void write_bn_to_file(FILE *file, const char *label, const BIGNUM *bn) {
    char *dec = BN_bn2dec(bn);
    if (!dec) { handleErrors(); }
    fprintf(file, "%s: %s\n", label, dec);
    OPENSSL_free(dec);
}

/**
 * @brief Saves the RSA key components in decimal format to files.
 *
 * @param[in] rsa_keypair Pointer to the RSA keypair.
 */
void save_key_components(RSA *rsa_keypair) {
    FILE *pub_file = fopen("public_key_components_hex.txt", "w");
    if (!pub_file) { handleErrors(); }

    const BIGNUM *n = RSA_get0_n(rsa_keypair);
    const BIGNUM *e = RSA_get0_e(rsa_keypair);

    write_bn_to_file(pub_file, "Modulus (n)", n);
    write_bn_to_file(pub_file, "Public Exponent (e)", e);

    fclose(pub_file);

    FILE *priv_file = fopen("private_key_components_hex.txt", "w");
    if (!priv_file) { handleErrors(); }

    const BIGNUM *d = RSA_get0_d(rsa_keypair);
    const BIGNUM *p = RSA_get0_p(rsa_keypair);
    const BIGNUM *q = RSA_get0_q(rsa_keypair);
    const BIGNUM *dmp1 = RSA_get0_dmp1(rsa_keypair);
    const BIGNUM *dmq1 = RSA_get0_dmq1(rsa_keypair);
    const BIGNUM *iqmp = RSA_get0_iqmp(rsa_keypair);

    write_bn_to_file(priv_file, "Modulus (n)", n);
    write_bn_to_file(priv_file, "Public Exponent (e)", e);
    write_bn_to_file(priv_file, "Private Exponent (d)", d);
    write_bn_to_file(priv_file, "Prime 1 (p)", p);
    write_bn_to_file(priv_file, "Prime 2 (q)", q);
    write_bn_to_file(priv_file, "Exponent 1 (dmp1)", dmp1);
    write_bn_to_file(priv_file, "Exponent 2 (dmq1)", dmq1);
    write_bn_to_file(priv_file, "Coefficient (iqmp)", iqmp);

    fclose(priv_file);
}

/**
 * @brief Encrypts data using AES-256-CBC with PKCS7 padding.
 *
 * @param[in] plaintext The plaintext data to encrypt.
 * @param[in] plaintext_len Length of the plaintext data.
 * @param[out] ciphertext The encrypted data.
 * @param[out] iv The initialization vector used for encryption.
 * @param[in] key The AES key.
 * @return int Length of the encrypted data.
 */
int aes_encrypt(const unsigned char *plaintext, int plaintext_len, unsigned char *ciphertext, unsigned char *iv, const unsigned char *key) {
    EVP_CIPHER_CTX *ctx;
    int len;
    int ciphertext_len;

    if (!(ctx = EVP_CIPHER_CTX_new())) handleErrors();
    if (1 != EVP_EncryptInit_ex(ctx, EVP_aes_256_cbc(), NULL, key, iv)) handleErrors();
    if (1 != EVP_EncryptUpdate(ctx, ciphertext, &len, plaintext, plaintext_len)) handleErrors();
    ciphertext_len = len;
    if (1 != EVP_EncryptFinal_ex(ctx, ciphertext + len, &len)) handleErrors();
    ciphertext_len += len;
    EVP_CIPHER_CTX_free(ctx);

    return ciphertext_len;
}

/**
 * @brief Decrypts data using AES-256-CBC with PKCS7 padding.
 *
 * @param[in] ciphertext The encrypted data to decrypt.
 * @param[in] ciphertext_len Length of the encrypted data.
 * @param[out] plaintext The decrypted data.
 * @param[in] iv The initialization vector used for decryption.
 * @param[in] key The AES key.
 * @return int Length of the decrypted data.
 */
int aes_decrypt(const unsigned char *ciphertext, int ciphertext_len, unsigned char *plaintext, const unsigned char *iv, const unsigned char *key) {
    EVP_CIPHER_CTX *ctx;
    int len;
    int plaintext_len;

    if (!(ctx = EVP_CIPHER_CTX_new())) handleErrors();
    if (1 != EVP_DecryptInit_ex(ctx, EVP_aes_256_cbc(), NULL, key, iv)) handleErrors();
    if (1 != EVP_DecryptUpdate(ctx, plaintext, &len, ciphertext, ciphertext_len)) handleErrors();
    plaintext_len = len;
    if (1 != EVP_DecryptFinal_ex(ctx, plaintext + len, &len)) handleErrors();
    plaintext_len += len;
    EVP_CIPHER_CTX_free(ctx);

    return plaintext_len;
}

/**
 * @brief Main function demonstrating RSA keypair generation, encryption, decryption, and signing.
 *
 * @return int Returns 0 on success, other values on failure.
 */
int main() {
    clock_t start, end;
    double cpu_time_used;

    start = clock();

    RSA *rsa_keypair = NULL;
    generate_keypair(&rsa_keypair);
    save_keys(rsa_keypair);
    save_key_components(rsa_keypair);

    const char *plaintext = "This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.This is a much longer message that exceeds the RSA encryption limit and needs to be encrypted using a symmetric key.";
    int plaintext_len = strlen(plaintext);

    // Generate a random AES key
    unsigned char aes_key[AES_KEY_SIZE / 8];
    if (!RAND_bytes(aes_key, sizeof(aes_key))) { handleErrors(); }

    // Encrypt the AES key with RSA
    unsigned char encrypted_aes_key[RSA_size(rsa_keypair)];
    int encrypted_aes_key_len = RSA_public_encrypt(sizeof(aes_key), aes_key, encrypted_aes_key, rsa_keypair, RSA_PKCS1_OAEP_PADDING);
    if (encrypted_aes_key_len == -1) { handleErrors(); }

    // Encrypt the plaintext with AES
    unsigned char iv[AES_BLOCK_SIZE];
    if (!RAND_bytes(iv, AES_BLOCK_SIZE)) { handleErrors(); }
    unsigned char *ciphertext = (unsigned char *)malloc(plaintext_len + AES_BLOCK_SIZE);
    if (!ciphertext) { handleErrors(); }
    int ciphertext_len = aes_encrypt((unsigned char *)plaintext, plaintext_len, ciphertext, iv, aes_key);

    // Decrypt the AES key with RSA
    unsigned char decrypted_aes_key[AES_KEY_SIZE / 8];
    int decrypted_aes_key_len = RSA_private_decrypt(encrypted_aes_key_len, encrypted_aes_key, decrypted_aes_key, rsa_keypair, RSA_PKCS1_OAEP_PADDING);
    if (decrypted_aes_key_len == -1) { handleErrors(); }

    // Decrypt the ciphertext with AES
    unsigned char *decrypted_text = (unsigned char *)malloc(ciphertext_len);
    if (!decrypted_text) { handleErrors(); }
    int decrypted_len = aes_decrypt(ciphertext, ciphertext_len, decrypted_text, iv, decrypted_aes_key);

    // Null-terminate the decrypted text
    decrypted_text[decrypted_len] = '\0';

    printf("Plaintext: %s\n", plaintext);
    printf("Ciphertext: ");
    for (int i = 0; i < ciphertext_len; i++) {
        printf("%02x", ciphertext[i]);
    }
    printf("\n");
    printf("Decrypted text: %s\n", decrypted_text);

    // Allocate memory for signature
    unsigned char *signature = (unsigned char *)malloc(RSA_size(rsa_keypair));
    if (!signature) { handleErrors(); }

    const char *message = "Hello Bob!";
    int message_len = strlen(message);

    // Sign message
    unsigned int signature_len;
    if (!RSA_sign(NID_sha256, (unsigned char *)message, message_len, signature, &signature_len, rsa_keypair)) {
        handleErrors();
    }

    // Verify signature
    int verified = RSA_verify(NID_sha256, (unsigned char *)message, message_len, signature, signature_len, rsa_keypair);

    (verified != 1) ? printf("Signature verification failed!\n") : printf("Signature verified. Message authenticated!\n");

    // Free memory
    RSA_free(rsa_keypair);
    free(ciphertext);
    free(decrypted_text);
    free(signature);

    end = clock();
    cpu_time_used = ((double) (end - start)) / CLOCKS_PER_SEC;
    printf("Time taken: %f seconds\n", cpu_time_used);

    return 0;
}